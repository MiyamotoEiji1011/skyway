<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>SkyWay テスト接続</title>

<!-- SkyWay Room SDK をブラウザ用に読み込み -->
<script src="https://cdn.jsdelivr.net/npm/@skyway-sdk/room@0.2.3/dist/skyway-room-latest.js"></script>

<script>
let localStream;
let room;

async function startConnection() {
  // 入力欄からトークンを取得
  const token = document.getElementById("tokenInput").value.trim();

  if (!token) {
    alert("トークンを入力してください！");
    return;
  }

  try {
    // カメラとマイクを取得
    localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    document.getElementById("myVideo").srcObject = localStream;

    // SkyWay Context 作成
    const context = await SkyWay.createContext({ authToken: token });

    // ルーム作成または参加
    room = await context.joinRoom("test-room", { type: "sfu" });

    // 自分の映像を送信
    room.publish(localStream);

    // 相手の映像を受信
    room.onStreamAdded.subscribe((event) => {
      document.getElementById("remoteVideo").srcObject = event.stream;
    });

    alert("接続完了！同じルームの人の映像が表示されます。");
  } catch (err) {
    console.error(err);
    alert("接続中にエラーが発生しました。コンソールを確認してください。");
  }
}
</script>
</head>
<body>
<h2>SkyWay テスト接続（トークン方式）</h2>

<label>SkyWay Auth Token:</label>
<input type="text" id="tokenInput" placeholder="ここにトークンを貼ってください" style="width:400px;">
<button onclick="startConnection()">接続開始</button>

<h3>自分の映像</h3>
<video id="myVideo" autoplay muted playsinline style="border:1px solid #000;" width="320" height="240"></video>

<h3>相手の映像</h3>
<video id="remoteVideo" autoplay playsinline style="border:1px solid #000;" width="320" height="240"></video>

</body>
</html>
