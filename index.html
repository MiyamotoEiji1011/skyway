<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>SkyWay テスト</title>
<script type="module">
import { SkyWayContext } from "https://cdn.jsdelivr.net/npm/@skyway-sdk/core@0.2.3/dist/skyway-core.js";

let localStream;
let room;

async function startConnection() {
  // トークンを入力してもらう
  const token = prompt("SkyWayのAuth Tokenを入力してください");

  // カメラ・マイク取得
  localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
  const myVideo = document.getElementById("myVideo");
  myVideo.srcObject = localStream;

  // SkyWay Context作成
  const context = await SkyWayContext.Create(token);

  // ルーム作成または参加
  room = await context.Room.Create({ name: "test-room", type: "sfu" });
  await room.Join();

  // 自分の映像を送信
  await room.LocalStream.Publish(localStream);

  // 他の人の映像を受信
  room.RemoteStreams.on("added", (remoteStream) => {
    const remoteVideo = document.getElementById("remoteVideo");
    remoteVideo.srcObject = remoteStream;
  });

  alert("接続完了！同じルームの人の映像が表示されます");
}
</script>
</head>
<body>
<h2>SkyWayテスト</h2>
<button onclick="startConnection()">接続開始</button>
<br><br>
<video id="myVideo" autoplay muted width="320" height="240" style="border:1px solid #000;"></video>
<video id="remoteVideo" autoplay width="320" height="240" style="border:1px solid #000;"></video>
</body>
</html>
